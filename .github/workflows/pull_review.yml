# Config ID: pulls.review
#
# This configuration file is auto-generated
# by https://github.com/otto-ec/assets_protecty.
#
# Do not modify this file unless you know what you do.
# All changes will be overwritten during next update run.
#
# If you need to modify this file permanently then place your configuration overrides in
# - .github/gitty.yml#/configs/pulls/review,
#
# and use the schema appropriate to this file.
# See https://github.com/otto-ec/assets_protecty#readme for more details and documentation.
#
# This config can be affected by these presets: base, default, terraform, non-assets
#
name: PR Review Request
"on":
  pull_request_target:
    types:
      - review_requested
      - review_request_removed
      - ready_for_review
jobs:
  check:
    runs-on: ubuntu-latest
    if: |-
      ${{
        github.event.pull_request.draft == false
        && !startsWith(github.event.pull_request.user.login, 'dependabot')
      }}
    outputs:
      requested: ${{ steps.reviews.outputs.requested }}
      reviews: ${{ steps.reviews.outputs.reviews }}
      approved: ${{ steps.reviews.outputs.approved }}
      changes_requested: ${{ steps.reviews.outputs.changes_requested }}
    steps:
      - name: Get Pull review info
        id: reviews
        uses: jurijzahn8019/action-get-pull-review-info@v0.0.81
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
  to-review:
    runs-on: ubuntu-latest
    needs:
      - check
    if: >-
      ${{  needs.check.outputs.requested > 0  || needs.check.outputs.reviews > 0
      }}
    steps:
      - name: Add Pull Request Label for approval
        uses: actions-ecosystem/action-add-labels@v1.1.3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          labels: "approval: waiting"
      - name: Remove Pull Request Label for approval
        uses: actions-ecosystem/action-remove-labels@v1.3.0
        continue-on-error: true
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          labels: "approval: submitted"
  to-progress:
    runs-on: ubuntu-latest
    needs:
      - check
    if: >-
      ${{  needs.check.outputs.requested < 1  && needs.check.outputs.reviews < 1
      }}
    steps:
      - name: Remove Pull Request Label for approval
        uses: actions-ecosystem/action-remove-labels@v1.3.0
        continue-on-error: true
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          labels: |
            approval: waiting
            approval: submitted
