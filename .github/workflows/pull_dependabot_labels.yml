# Config ID: dependabot.labels
#
# This configuration file is auto-generated
# by https://github.com/otto-ec/assets_protecty.
#
# Do not modify this file unless you know what you do.
# All changes will be overwritten during next update run.
#
# If you need to modify this file permanently then place your configuration overrides in
# - .github/gitty.yml#/configs/dependabot/labels,
#
# and use the schema appropriate to this file.
# See https://github.com/otto-ec/assets_protecty#readme for more details and documentation.
#
# This config can be affected by these presets: base, default, terraform, non-assets
#
name: Dependency PR Checks
"on":
  pull_request_target:
    types:
      - labeled
      - unlabeled
      - synchronize
      - opened
      - edited
      - ready_for_review
      - reopened
      - unlocked
permissions:
  contents: read
  pull-requests: write
  checks: write
  statuses: write
jobs:
  deps-labels:
    runs-on: ubuntu-latest
    if: ${{ startsWith(github.event.pull_request.user.login, 'dependabot') }}
    steps:
      - uses: jurijzahn8019/action-dependabot-bump-range@v0.0.115
        id: checker
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      - name: Add Pull Request Label for Version Diff
        uses: actions-ecosystem/action-add-labels@v1.1.3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          labels: "dependency: ${{ steps.checker.outputs.diff }}"
      - name: Add Pull Request Label for Major Updates
        uses: actions-ecosystem/action-add-labels@v1.1.3
        if: steps.checker.outputs.diff == 'major'
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          labels: "pull: not merge"
      - name: Instruct dependabot to merge pr
        if: ${{ steps.checker.outputs.diff != 'major' }}
        uses: mshick/add-pr-comment@v2
        with:
          repo-token: ${{ secrets.TOKEN_GITHUB }}
          message: |
            @dependabot merge
          allow-repeats: false
  pull-approved:
    needs:
      - deps-labels
    runs-on: ubuntu-latest
    steps:
      - name: Set approval check to success
        uses: LouisBrunner/checks-action@v1.5.0
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          name: pull-approved
          conclusion: success
          sha: ${{ github.event.pull_request.head.sha }}
          output: |
            {"summary": "Dependency update does not need approvals" }
